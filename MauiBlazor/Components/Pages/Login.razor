@page "/"

@using ApiClient.Models
@using ApiClient
@inject ApiClient.ApiClientService ApiService
@inject NavigationManager Navigation
@inject Services.AppData AppData

<div class="row justify-content-center my-4">
    <div class="col-auto">
        <img src=logo.png alt="Firmenlogo" />
        @* <img src="logo.png" alt="Firmenlogo" class="img-fluid"> *@
    </div>
</div>
<div class="container">
    <div class="row justify-content-center align-items-center" >
        <div class="card">
            <div class="card-body">
                <EditForm Model="@homeModel" OnValidSubmit="@Submit">
                    <DataAnnotationsValidator />
                    <h1 class="card-title text-center"> Willkommen </h1>
                    <h3 class="card-title text-center"> Login </h3>
                    <div class="form-group">
                        <label for="username"> Benutzername </label>
                        <input type="text" @bind-value="homeModel.UserId" class="form-control" placeholder="MatrikelNr/MitarbeiterNr eingeben">
                        <ValidationMessage For="@(() => homeModel.UserId)" />
                    </div>
                    <div class="form-group">
                        <label for="password">Passwort</label>
                        <input type="password" @bind-value="homeModel.Password" class="form-control">
                        <ValidationMessage For="@(() => homeModel.Password)" />
                    </div>
                    <br /> @* Zeilenumbruch *@
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block btn-login"> Einloggen </button>
                    </div>

                    <div class="hyperlinks">
                        <div class="text-center">
                            <NavLink class="nav-link" href="passwordReset">
                                <span> Passwort vergessen? </span>
                            </NavLink>
                        </div>
                        <div class="text-center mt-2">
                            Noch kein Konto? 
                            <NavLink class="nav-link" href="registration"> 
                                <span> Hier registrieren </span>
                            </NavLink>
                        </div>
                    </div>
                </EditForm>
            </div>
        </div>
    </div>   
</div>

@code {
    HomeModel homeModel = new();

    private async void Submit()
    {
        try
        {
            var projects = await ApiService.Login(homeModel.UserId, homeModel.Password!);
            if (projects == null)
			{
				Console.WriteLine("Fehler beim Login");
				return;
			}
            AppData.ProjectViewModel = new ProjectViewModel(projects!);
            Navigation.NavigateTo("feed");
        }
        catch (HttpRequestException ex)
        {
            Console.WriteLine($"Ein HTTP-Fehler ist aufgetreten: {ex.Message}");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Ein unerwarteter Fehler ist aufgetreten: {ex.Message}");
        }
    }

    // var httpContextAccessor = Context.RequestServices.GetService(typeof(IHttpContextAccessor)) as IHttpContextAccessor;
    // var user = httpContextAccessor.HttpContext.Session.GetInt32("UserId");
}
